### **【成果物3/3】 設計書 (Design Document)**

これは、仕様書で定義された要件を、VBAのコードやExcelの機能レベルでどのように実現するかを具体的に記述した技術ドキュメントです。

---

**文書管理**

| ドキュメント名 | 点検報告書 旧データ移行ツール 設計書 |
| :--- | :--- |
| バージョン | 1.3 |
| 作成日 | 2025年7月5日 |
| 作成者 | (あなたのためのVBAプロフェッショナル) |
| 承認者 | (お客様名) |

---

### **1. 概要**

本設計書は、「点検報告書 旧データ移行ツール 仕様書 Ver.1.1」で定義された要件を実現するための、技術的な実装方法を定義するものである。VBAのモジュール構成、各機能の実装ロジック、およびエラーハンドリングの具体的な手法について詳述する。

### **2. システムアーキテクチャ**

#### **2.1. Excelブックとシート構成**

本ツール（以下、マクロブック）は、以下のシートで構成される。

-   **`Control`**: ユーザーインターフェースシート。マクロ実行ボタンを配置する。
-   **`Settings`**: 処理設定シート。ユーザーが処理内容を定義する。
-   **`List`**: テンプレートファイルのマスタリストシート。
-   **`Log`**: 処理ログ出力シート。
-   **`ErrorLog`**: エラーログ出力シート。
-   **`DebugLog`**: デバッグログ出力シート。開発時のみ使用する。

#### **2.2. VBAプロジェクト構成**

VBAコードは機能ごとにモジュールを分割し、保守性と可読性を高める。

-   **`M01_Main`**: メインコントローラー。
-   **`M02_Processor`**: データ処理のコアロジック。
-   **`M03_FileHandler`**: ファイル操作関連。
-   **`M04_Logger`**: `Log`および`Error`シートへの書き込み処理。
-   **`M05_Utility`**: 汎用的な便利機能。
-   **`M06_DebugLogger`**: `DebugLog`シートへの書き込み処理。

### **3. デバッグ機能**

#### **3.1. デバッグモード**

-   `M06_DebugLogger`モジュール内の定数 `IS_DEBUG_MODE` を `True` に設定することで、デバッグモードが有効になる。
-   デバッグモードが有効の場合、`DebugLog`シートに処理の詳細なログが日本語で出力される。
-   `IS_DEBUG_MODE` を `False` に設定すると、デバッグログの出力はすべて抑制され、パフォーマンスへの影響をなくすことができる。

### **4. VBAモジュール詳細設計**

#### **4.1. Settingsシート**

`Settings`シートは、マクロの動作を制御するための設定情報を保持する。特に、以下のセルはVBAコードによって参照される。

-   `旧ブック_ファイルパス` (D7): 処理対象となる旧報告書のフルパス。
-   `旧ブック_新ブック名判定アドレス` (D8): 新報告書の種類を特定するための、旧報告書内のセルアドレス。
-   `出力ブック_保存先フォルダ` (D9): 作成される新報告書の保存先フォルダのフルパス。このセルが空白の場合、VBA実行中のExcelファイルと同じフォルダが使用される。

(各モジュールの詳細設計は、コード内のコメントに記載の通り)

---
