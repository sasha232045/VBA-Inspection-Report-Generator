
### **1. プロジェクトの背景と目的**

現在、Excelで管理している旧バージョンの点検報告書から新バージョンの報告書を作成するにあたり、多くのデータを手作業でコピー＆ペーストしています。この作業は時間がかかる上に、転記ミスなどのヒューマンエラーが発生するリスクがあります。

この手作業を完全に自動化し、**「作業時間の短縮」**と**「品質の安定化（エラー撲滅）」**を実現するVBAマクロツールを開発することが本プロジェクトの目的です。

---

### **2. 依頼内容と納品物**

以下の成果物を、指定された順番で作成してください。

1.  **ドキュメント類:**
    a. **README.md:** ツールの概要、特徴、使い方をまとめたドキュメント。
    b. **仕様書:** ツールが「何を」すべきか、機能要件を定義したドキュメント。
    c. **設計書:** 仕様を「どのように」実現するか、技術的な実装方法を定義したドキュメント。
2.  **VBAコード:** 上記設計書に基づいた、完全に動作するVBAのソースコード。

**【重要】**
- **もし、これらの要件定義に不明な点や、より良くするための提案があれば、実装に着手する前に必ず質問してください。**
- **あなたの出力はトークン数の制限により途中で途切れる可能性があります。その場合、文章の要約や省略は一切せず、必ず文章の最後に「続きと入力し、続きの出力を促してください。」と記載してください。**

---

### **3. ツールの全体像とシート構成**

ツールは単一のExcelマクロ有効ブック（`.xlsm`）として作成します。このブックは以下のシートで構成してください。

-   `Control`シート: ユーザーがマクロを実行するためのボタンを配置する操作画面。
-   `Settings`シート: データ移行のルールを定義する設定シート。
-   `List`シート: 報告書の種類とテンプレートファイルのパスを管理するマスタリスト。
-   `Log`シート: マクロの実行履歴を記録するログシート。
-   `Error`シート: 処理中に発生したエラーを記録するエラーシート。

---

### **4. シートの詳細仕様**

#### **4.1. `Settings`シート**

このシートは、マクロの動作を制御する中心的なシートです。

**A) 全体設定エリア (B2:D13)**
-   **旧ブック_ファイルパス (D2):** ユーザーが処理元となる旧ブックのフルパスを入力します。
-   **旧ブック_新ブック名判定アドレス (D3):** 新ブックの種類を特定するために参照する、旧ブック内のセルアドレス（例: `'87'!T7:AB7`）をユーザーが入力します。
-   以下のセルには、**VBAではなくExcelのシート関数を埋め込んでください。** これにより、ユーザーがパスを入力した際に動的に情報が更新され、確認が容易になります。
    -   `D5` (旧ブック_ファイル名): `D2`のパスからファイル名のみを抽出する式。
    -   `D6`～`D9` (単価契約明細ＮＯなど): `D5`のファイル名を特定の文字列で分割して情報を抽出する式。
    -   `D10` (種類): 旧ブックが開いている場合、`D3`のアドレスの値を`INDIRECT`関数で参照する式。
    -   `D11` (新ブック_ファイルパス): `D10`の「種類」をキーに`List`シートを`XLOOKUP`関数で検索し、該当するテンプレートパスを取得する式。
    -   `D12`, `D13` (本部, 管内): `List`シートから関連情報を`XLOOKUP`関数で取得する式。

**B) 処理詳細設定エリア (A15以降)**
-   このエリアに、実際のデータ移行手順をユーザーが定義します。
-   **列構成:** `処理シートNo`, `処理No.`, `処理内容`, `内容`
-   **`処理内容`の種類:** `旧ブック_シート名`, `新ブック_シート名`, `旧ブック_コピー元アドレス`, `新ブック_コピー先アドレス`, `新ブック_削除するアドレス`, `新ブック_入力するアドレス`, `新ブック_入力する内容`
-   **データ例:**
    ```
    処理シートNo,処理No.,処理内容,内容
    1,1,旧ブック_シート名,統一表紙
    1,2,新ブック_シート名,共通(77kV以下)
    1,3,旧ブック_コピー元アドレス,A4:CH62
    1,4,新ブック_コピー先アドレス,A4
    1,5,新ブック_削除するアドレス,"BO22,BO23,BO24,BJ25,AF30:AF41"
    1,6,新ブック_入力するアドレス,"P14,AH14"
    1,7,新ブック_入力する内容,2025.07.05
    ```

#### **4.2. `List`シート**

新ブックの元となるテンプレートファイルを管理するマスタデータです。

-   **データ例:**
    ```
    判断結果,本部,管内,,判断結果,種類,ファイルパス
    ,大阪南,南大阪,,,日新Cub-123TrB,C:\...\日新Ｃｕｂ変電所-123TrB Ry-2025.99.99（データ入力中）.xls
    ```
-   マクロは、旧ブックから取得した「種類」の値と、このシートの「種類」(F列)を照合し、対応する「ファイルパス」(G列)を取得します。

---

### **5. マクロの機能要件と処理フロー**

`Control`シートの実行ボタンを押すと、以下の処理を順番に実行してください。

1.  **初期化:** `Log`シートと`Error`シートの内容をクリアし、ヘッダー行を書き込みます。
2.  **設定読み込み:** `Settings`シートから`旧ブック_ファイルパス`(D2)と`旧ブック_新ブック名判定アドレス`(D3)を読み込みます。
3.  **新ブックの準備:**
    a. `旧ブック_ファイルパス`を元に旧ブックを開きます。
    b. 旧ブックの`旧ブック_新ブック名判定アドレス`から値（=種類）を取得します。
    c. 取得した「種類」をキーに`List`シートを検索し、使用すべきテンプレートのパスを特定します。
    d. 特定したテンプレートファイルを**コピー**し、`List`シートに記載されている新しいファイル名で保存します。これが「新ブック」となります。
    e. 旧ブックは用済みなので閉じます。
4.  **データ移行処理:**
    a. `Settings`シートのA16行以降の処理リストを上から順に実行します。
    b. **コピー処理:** `旧ブック_コピー元アドレス`から`新ブック_コピー先アドレス`へ、**書式、数式、値など全てをコピー**してください。
    c. **削除処理:** `新ブック_削除するアドレス`で指定されたセルの**内容のみを削除** (`ClearContents`) してください。アドレス指定は、`A1`のような単一セル、`A1:B10`のような範囲、`A1,B5,C10:D12`のようなカンマ区切りの複数指定、その全てに対応してください。
    d. **入力処理:** `新ブック_入力するアドレス`で指定されたセルに、`新ブック_入力する内容`の値を入力してください。アドレスは削除処理と同様に複数指定に対応してください。
5.  **終了処理:**
    a. すべての処理が完了したら、新ブックを上書き保存して閉じます。
    b. ユーザーに「処理が完了しました。」というメッセージを表示します。`Error`シートに何らかの記録がある場合は、「ただし、いくつかのエラーが発生しました。Errorシートを確認してください。」と追記してください。

---

### **6. 技術要件と品質要求**

-   **エラーハンドリング:** 処理中にエラー（例：指定シートが存在しない、指定セル範囲がない）が発生しても、**マクロは停止しないでください。** エラー内容を`Error`シートに記録し、次の処理へ進んでください。
-   **結合セルへの対応:** コピー、削除、入力の各処理は、対象範囲に結合されたセルが含まれていても、エラーを起こさず正しく実行できるようにしてください。
-   **コードの保守性:** VBAコードは機能ごとに標準モジュールを分割してください（例: `M_Main`, `M_Processor`, `M_FileHandler`, `M_Logger`, `M_Utility`）。変数名やプロシージャ名は、その役割が理解しやすいように命名してください。適切なコメントを付与してください。
-   **堅牢性:** `On Error Resume Next`と`On Error GoTo 0`を適切に使い分け、予期せぬエラーでツールが停止することを極力防いでください。

以上の要件に基づき、まずはドキュメント類の作成から開始してください。